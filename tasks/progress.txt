## Codebase Patterns
- Typecheck errors in dist/lib/pkg/ and node_modules/ are pre-existing issues from protobuf generation and dependencies, not from source code changes
- Component exports are centralized in src/ts/component/index.ts
- Popup components are registered in src/ts/component/popup/index.tsx (both import and Components object)
- When removing a feature, make functions no-ops rather than deleting them to avoid breaking callers
- Settings sidebar items are in src/ts/component/sidebar/page/settings/index.tsx
- Settings page components are registered in src/ts/component/page/main/settings/index.tsx
- Menu components are registered in src/ts/component/menu/index.tsx (both import and Components object)
- Publishing-related commands are in lib/api/command.ts under the PUBLISHING section
- Share button in headers is controlled by showShare variable - set to false to hide
- Invite popups (confirm, qr, request) and share popup are registered in popup/index.tsx Components object
- Space settings invite/qr/copyLink buttons are in getButtons() in settings/space/index.tsx
- Join notification handling is in notification/index.tsx case I.NotificationType.Join
- U.Common.onInviteRequest() and U.Menu.inviteContext() are utility wrappers for invite UI
- PopupSpaceJoinByLink routes to /main/invite/ page - both need to be addressed together
- Analytics is in src/ts/lib/analytics.ts - uses Amplitude, ~313 event calls across ~147 files. Gut the class to no-ops rather than touching callers. Keep the route object (used as string constants)
- Sentry is initialized in app.tsx with DSN from rspack DefinePlugin, also used in dispatcher.ts and data.ts
- Electron debug flags are in electron/js/menu.js in the `flags` object
- Electron auto-update is managed by electron/js/update.js (UpdateManager) using electron-updater. It's used from: electron.js (init), api.js (API handlers), menu.js (menu items + tray), and app.tsx (IPC event handlers)
- Update UI has two display points: vault sidebar (vault/update.tsx as ItemProgress) and ListBanner (list/banner.tsx)
- The vault sidebar (vault.tsx) injects an update-progress item into the space list via getItems() when updateVersion or progress exists

---

## 2026-02-07 - US-006
- What was implemented: Removed space sharing settings pages
- Files changed:
  - src/ts/component/sidebar/page/settings/index.tsx - Removed spaceShare from sidebar menu
  - src/ts/component/page/main/settings/index.tsx - Removed PageSpaceShare import, registration, and from SPACE_PAGES
  - src/ts/component/page/main/settings/space/share.tsx - Stubbed to return null
  - src/ts/lib/action.ts - Made openSpaceShare a no-op
  - src/ts/lib/keyboard.ts - Removed spaceShare from navigation handler
- **Learnings for future iterations:**
  - Space share settings had a keyboard.ts reference for back navigation handling
  - The share.tsx component imports a Members sub-component from share/members.tsx - stubbing share.tsx makes members.tsx unreachable too
  - Action.openSpaceShare is called from other places - making it a no-op is safer than tracking all callers

---

## 2026-02-07 - US-005
- What was implemented: Removed publishing UI, commands, and sidebar item
- Files changed:
  - src/ts/component/sidebar/page/settings/index.tsx - Removed dataPublish from sidebar menu
  - src/ts/component/page/main/settings/index.tsx - Removed PageDataPublish import and registration
  - src/ts/lib/api/command.ts - Removed Publishing* commands (PublishingCreate, PublishingRemove, PublishingList, PublishingResolveUri, PublishingGetStatus)
  - src/ts/component/menu/index.tsx - Removed MenuPublish import and registration
  - src/ts/component/header/main/object.tsx - Disabled share button (showShare = false), made onShare no-op
  - src/ts/component/header/main/history.tsx - Disabled share button (showShare = false), made onShare no-op
  - src/ts/component/editor/page.tsx - Removed 'publish' from menuCheck
  - src/ts/component/menu/publish.tsx - Stubbed to return null
  - src/ts/component/page/main/settings/data/publish.tsx - Stubbed to return null
  - src/ts/component/page/main/settings/data/index.tsx - Removed PublishingList call and unused state
- **Learnings for future iterations:**
  - Publishing involves multiple UI touchpoints: settings sidebar, settings page, object header share button, history header share button, editor menuCheck
  - The share button in headers opens the publish menu - disabling publishing means disabling the share button
  - Stubbing components to return null is cleaner than deleting them when imports still exist elsewhere

---

## 2026-02-07 - US-003
- What was implemented: Completed removal of membership popups and UpsellBanner component
- Files changed:
  - src/ts/component/popup/index.tsx - Removed imports and registrations for PopupMembership, PopupMembershipActivation, PopupMembershipFinalization
  - src/ts/component/index.ts - Removed UpsellBanner import and export
  - src/ts/component/menu/syncStatus.tsx - Removed UpsellBanner import and usage
  - src/ts/component/page/main/settings/space/storage.tsx - Removed UpsellBanner import and usage
  - src/ts/component/page/main/settings/space/share.tsx - Removed UpsellBanner import and usage
  - src/ts/lib/action.ts - Made membershipUpgrade and membershipUpgradeViaEmail no-ops
  - src/ts/component/menu/identity.tsx - Made onClick no-op
  - src/ts/component/menu/syncStatus/info.tsx - Made upgradeMembership case no-op
  - src/ts/component/page/auth/setup.tsx - Simplified cb1 to skip membership finalization check
  - src/ts/component/page/main/membership.tsx - Simplified init to just redirect to dashboard
  - src/ts/component/popup/invite/confirm.tsx - Made onMembership no-op
- **Learnings for future iterations:**
  - The membership popup had 3 variants: main, activation, and finalization - all need to be removed together
  - UpsellBanner was used in syncStatus menu, storage settings, and share settings
  - Action.membershipUpgrade is called from multiple places - making it a no-op is safer than finding all callers
  - Page components can be left in place if they're unreachable from routes/sidebar

---

## 2026-02-08 - US-007
- What was implemented: Removed invite popups, invite page, share popup, and space join notification handling
- Files changed:
  - src/ts/component/popup/index.tsx - Removed imports and registrations for PopupInviteRequest, PopupInviteConfirm, PopupInviteQr, PopupShare, PopupSpaceJoinByLink
  - src/ts/component/popup/invite/confirm.tsx - Stubbed to return null
  - src/ts/component/popup/invite/qr.tsx - Stubbed to return null
  - src/ts/component/popup/invite/request.tsx - Stubbed to return null
  - src/ts/component/popup/share.tsx - Stubbed to return null
  - src/ts/component/popup/space/joinByLink.tsx - Stubbed to return null
  - src/ts/component/page/main/invite.tsx - Stubbed to redirect to dashboard
  - src/ts/component/page/main/object.tsx - Changed invite redirect to go to dashboard instead
  - src/ts/component/notification/index.tsx - Removed Join notification buttons and inviteConfirm popup opening
  - src/ts/component/menu/help.tsx - Removed 'share' menu item and its handler
  - src/ts/component/page/main/settings/space/index.tsx - Made getButtons() return empty array (removed invite/copyLink/qr)
  - src/ts/lib/util/common.ts - Made onInviteRequest a no-op
  - src/ts/lib/util/menu.ts - Made inviteContext a no-op
  - src/ts/store/popup.ts - Removed 'inviteQr' from NO_DIMMER_IDS
- **Learnings for future iterations:**
  - Invite flow has many touchpoints: popup components, page route, notification handler, space settings buttons, help menu, utility functions
  - PopupSpaceJoinByLink navigates to /main/invite/ page - removing the invite page means also stubbing joinByLink
  - page/main/object.tsx has a redirect to invite page when cid/key params present - needs to redirect to dashboard in offline mode
  - The help menu has a 'share' item that opens the share popup (share the Anytype app link) - distinct from space sharing
  - Space settings index has getButtons() that returns invite/copyLink/qr buttons based on cid/key state
- NotificationList/NotificationReply are used for general notifications (import/export/gallery), not just sharing - keep them
- Action.inviteRevoke is a wrapper that calls C.SpaceInviteRevoke - make it a no-op when removing the command
- U.Space.getInvite wraps C.SpaceInviteGetCurrent - make it a no-op when removing the command
- share/members.tsx uses C.SpaceRequestDecline, C.SpaceParticipantRemove, C.SpaceRequestApprove, C.SpaceParticipantPermissionsChange - must be stubbed even though unreachable
- Space create popup auto-shares chat spaces via C.SpaceMakeShareable + C.SpaceInviteGenerate - remove for offline mode

---

## 2026-02-08 - US-010
- What was implemented: Removed sync state tracking from auth store and removed DeviceList, DebugNetCheck, AccountRecover gRPC commands
- Files changed:
  - src/ts/store/auth.ts - Removed syncStatusMap field, made syncStatusUpdate a no-op, made getSyncStatus return default offline status, made getNotSynced return zero, removed syncStatusMap.clear() from clearAll, cleaned up unused intercept import
  - src/ts/lib/api/command.ts - Removed AccountRecover, DebugNetCheck, DeviceList commands
  - src/ts/lib/api/response.ts - Removed DebugNetCheck, DeviceList response handlers
  - src/ts/lib/api/dispatcher.ts - Made SpaceSyncStatusUpdate/P2PStatusUpdate handler a no-op
  - src/ts/lib/keyboard.ts - Made debugNet keyboard shortcut handler a no-op
  - src/ts/component/page/auth/login.tsx - Replaced C.AccountRecover with stored accountId lookup for offline-only login
- **Learnings for future iterations:**
  - AccountRecover is used in login.tsx for network-based account discovery after WalletRecover - in offline mode, use Storage.get('accountId') instead
  - The login flow works: WalletRecover → createSession → accountAdd with stored ID → select() picks up via useEffect → AccountSelect completes login
  - DebugNetCheck is only called from keyboard.ts debugNet shortcut handler
  - DeviceList had no callers in the codebase - was likely intended for future P2P device management UI
  - getSyncStatus and getNotSynced callers were already removed in US-009, so making them return defaults is safe
  - syncStatusUpdate is called from dispatcher.ts for SpaceSyncStatusUpdate and P2PStatusUpdate events - made it a no-op

---

## 2026-02-08 - US-008
- What was implemented: Removed all 13 space sharing/invite gRPC commands and their references
- Files changed:
  - src/ts/lib/api/command.ts - Removed SpaceInviteGenerate, SpaceInviteChange, SpaceInviteView, SpaceInviteRevoke, SpaceInviteGetCurrent, SpaceStopSharing, SpaceMakeShareable, SpaceJoin, SpaceJoinCancel, SpaceRequestApprove, SpaceRequestDecline, SpaceParticipantPermissionsChange, SpaceParticipantRemove
  - src/ts/lib/api/response.ts - Removed SpaceInviteGenerate, SpaceInviteGetCurrent, SpaceInviteView response handlers
  - src/ts/lib/action.ts - Made inviteRevoke a no-op
  - src/ts/lib/util/space.ts - Made getInvite a no-op
  - src/ts/component/popup/space/create.tsx - Removed isChatSpace auto-sharing (SpaceMakeShareable + SpaceInviteGenerate)
  - src/ts/component/page/main/settings/space/share/members.tsx - Stubbed to return null
  - src/ts/lib/api/dispatcher.ts - Removed SpaceInviteGetCurrent from SKIP_SENTRY_ERRORS
  - src/json/error.ts - Removed SpaceInviteView and SpaceJoin error codes
- **Learnings for future iterations:**
  - NotificationList and NotificationReply are used for general notifications (import/export/gallery), not just sharing - don't remove them
  - The chat space creation flow auto-shares via SpaceMakeShareable + SpaceInviteGenerate - needs to be removed for offline-only
  - Even unreachable components like share/members.tsx must be stubbed if they reference removed exports, because TypeScript still checks them
  - Response handlers in response.ts must also be removed when commands are removed

---

## 2026-02-08 - US-011
- What was implemented: Removed all analytics and telemetry (Amplitude + Sentry)
- Files changed:
  - src/ts/lib/analytics.ts - Gutted entire class: removed Amplitude import, made all methods no-ops (init, event, profile, setProperty, setContext, setTier, setVersion, stackAdd, stackSend, log, etc.), kept route object and typeMapper/embedType/networkType stubs for callers
  - src/ts/app.tsx - Removed Sentry import, Sentry.init() block, Sentry.setContext() call, analytics.init() call
  - src/ts/lib/api/dispatcher.ts - Removed Sentry import, Sentry.captureMessage calls, SKIP_SENTRY_ERRORS constant, analytics Exception event
  - src/ts/lib/util/data.ts - Removed Sentry import and Sentry.setUser() call
  - src/json/constant.ts - Cleared amplitude API key and sentry DSN to empty strings
  - rspack.config.js - Cleared SENTRY_DSN default to empty string
  - src/ts/global.d.ts - Removed SENTRY_DSN global declaration
  - electron/js/menu.js - Removed analytics debug flag from flags menu
- **Learnings for future iterations:**
  - Analytics has ~313 references across ~147 files - gutting the analytics class to no-ops is far safer than touching every caller
  - The analytics module exports a route object that's used as string constants throughout the codebase - must keep this even when disabling tracking
  - analytics.typeMapper() is called from widget/index.tsx for data passed to event() - must keep stub even though event is a no-op
  - Sentry is used in 3 files: app.tsx (init), dispatcher.ts (captureMessage for errors), data.ts (setUser)
  - SENTRY_DSN is injected via rspack DefinePlugin with a default fallback - clear both the env var default and constant.ts
  - The analytics debug flag in Electron menu controls config.debug.analytics which is read by analytics.debug() - removing the flag is cleaner than leaving a dead toggle

---

## 2026-02-08 - US-012
- What was implemented: Removed Electron auto-update functionality
- Files changed:
  - electron/js/update.js - Gutted entire UpdateManager class: removed electron-updater import, made all methods no-ops, isAllowed() returns false
  - electron.js - Removed UpdateManager require, removed setWindow() and init() calls
  - electron/js/api.js - Removed UpdateManager import, made updateCheck/updateDownload/updateConfirm/updateCancel no-ops, removed UpdateManager.relaunch() from shutdown() (now always app.exit(0)), removed UpdateManager.setChannel() from setChannel()
  - electron/js/menu.js - Removed UpdateManager import/isAllowed from initMenu() and initTray(), removed "Check Updates" from main Anytype menu and tray menu, removed version/channel submenu
  - src/ts/app.tsx - Removed update-not-available, update-downloaded, update-error, download-progress IPC event registrations and all four handler functions (onUpdateDownloaded, onUpdateUnavailable, onUpdateError, onUpdateProgress)
  - src/ts/component/sidebar/page/vault/update.tsx - Stubbed to return null
  - src/ts/component/list/banner.tsx - Stubbed to return null
  - src/ts/component/sidebar/page/vault.tsx - Removed ItemProgress import, removed updateVersion from S.Common, removed progress Update type tracking, removed update-progress item injection in getItems(), removed isProgress branch in rowRenderer, simplified getRowHeight
  - src/ts/lib/util/common.ts - Made checkUpdateVersion a no-op
- **Learnings for future iterations:**
  - The auto-update system spans 4 Electron main process files (update.js, api.js, menu.js, electron.js) and 5 renderer files (app.tsx, vault.tsx, vault/update.tsx, banner.tsx, common.ts)
  - The vault sidebar injects a special "update-progress" item at the top of the space list via getItems() when an update is downloading or available
  - shutdown() in api.js branches on relaunch param: true calls UpdateManager.relaunch() (quitAndInstall), false calls app.exit(0) - in offline mode, always use app.exit(0)
  - The menu.js version/channel submenu uses UpdateManager.isUpdating to prevent channel changes during updates
  - updateVersionSet/updateVersion in store/common.ts are now dead code but kept as harmless stubs
  - ListBanner is exported from component/index.ts - stubbing it to return null is cleaner than removing the export
- **Test plan results:** typecheck pass, lint pass, build:dev pass. Browser console check requires running Electron app with middleware — needs manual verification.

---

## 2026-02-08 - US-013
- What was implemented: Removed online state tracking and simplified network utility functions for offline-only mode
- Files changed:
  - src/ts/store/common.ts - Removed isOnlineValue field, isOnline computed property, isOnlineSet action, and their MobX decorators
  - src/ts/lib/util/data.ts - Made isAnytypeNetwork() always return false, isDevelopmentNetwork() always return false, isLocalNetwork() always return true
  - src/ts/lib/keyboard.ts - Removed S.Common.isOnlineSet(navigator.onLine) initialization and the online/offline window event handler (which also fetched membership tiers)
  - src/ts/component/block/embed.tsx - Replaced S.Common.isOnline with navigator.onLine for embed rendering (Latex/Mermaid render locally; external embeds depend on actual network)
  - src/ts/lib/util/space.ts - Made isShareActive() always return false, simplified getInviteLink() to always use protocol format
- **Learnings for future iterations:**
  - isOnline tracked navigator.onLine via the store — for features that genuinely depend on actual internet (like embeds), use navigator.onLine directly instead of the store
  - isAnytypeNetwork/isDevelopmentNetwork/isLocalNetwork are checked by several callers (upsell, data settings, phrase settings, isFreeMember) — making them return constants is safer than removing them and touching all callers
  - spaceStorage in common store tracks local storage (bytesLimit, localUsage, spaces[].bytesUsage) — it's NOT remote-only, so it should be kept
  - isFreeMember() uses isAnytypeNetwork() — with it returning false, isFreeMember always returns false, which is correct for offline mode
  - The keyboard.ts online/offline handler also fetched membership tiers on reconnect — removing this is fine since membership is already disabled

---

## 2026-02-09 - US-014
- What was implemented: Cleaned up all online-dependent UI conditionals in component code
- Files changed:
  - src/ts/component/util/upsell/index.tsx - Simplified to always return null (isAnytypeNetwork() returns false, so canShow was always false)
  - src/ts/component/page/main/settings/data/index.tsx - Inlined 'LocalOnly' suffix (isLocalNetwork() always true), removed isLocalNetwork variable and ternary conditionals for confirm/cancel labels
  - src/ts/component/page/main/settings/phrase.tsx - Removed dead delete-account section (!isLocal was always false), removed unused Button import and onPage prop
- **Learnings for future iterations:**
  - S.Common.isOnline was already fully removed in US-013 — no component references remained
  - embed.tsx uses navigator.onLine (browser native API) not S.Common.isOnline — this is correct for detecting actual internet for external embeds
  - UpsellBanner had complex logic that was entirely dead code since isAnytypeNetwork() returns false — safe to gut entirely
  - phrase.tsx had a delete-account section gated behind !isLocal which was always false in offline mode — removing it is cleaner
  - The lib/ functions (isAnytypeNetwork, isDevelopmentNetwork, isLocalNetwork) are kept as constant-returning stubs for any remaining non-component callers like isFreeMember()

---
